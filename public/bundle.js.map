{"version":3,"file":"bundle.js","sources":["../src/webcam.js","../src/trunkDetector.js","../src/canvas.js","../src/app.js","../src/main.js"],"sourcesContent":["class Webcam {\n    constructor({ video, width = 640, height = 480, autostart = true}) {\n        this.video = video;\n        this.video.width = width;\n        this.video.height = height;\n        this.autostart = autostart;\n    }\n\n    async init() {\n        const stream = await navigator.mediaDevices.getUserMedia({\n            'audio': false,\n            'video': {\n                facingMode: 'environment',\n                width: this.video.width,\n                height: this.video.height,\n            },\n        });\n        this.video.srcObject = stream;\n    \n        return new Promise((resolve) => {\n            this.video.onloadedmetadata = () => {\n                if (this.autostart) this.video.play();\n                resolve();\n            }\n        });\n    }\n}\n\nexport default Webcam;","class TrunkDetector {\n    constructor({ \n        video, \n        callback = null, \n        options = {\n            architecture: 'MobileNetV1',\n            imageScaleFactor: 0.3,\n            outputStride: 16,\n            inputResolution: 193,\n            flipHorizontal: false,\n            minConfidence: 0.5,\n            maxPoseDetections: 5,\n            scoreThreshold: 0.5,\n            nmsRadius: 20,\n            detectionType: 'single',\n            multiplier: 0.75,\n            quantBytes: 2,\n          }\n    }) {\n        this.video = video;\n        this.callback = callback;\n        this.options = options;\n    }\n\n    onDetect(callback) { this.callback = callback; }\n\n    start() {\n        this.net = ml5.poseNet(\n            this.video, \n            this.options, \n            () => this.ready()\n        );\n    }\n\n    ready() {\n        console.log(\"Detector started!\");\n\n        this.net.on(\"pose\", res => this.detected(res[0]));\n    }\n\n    calcAnchor(pose) {\n        let x = [\n            pose.leftShoulder.x, \n            pose.rightShoulder.x,\n            pose.leftHip.x,\n            pose.rightHip.x\n        ];\n\n        let y = [\n            pose.leftShoulder.y, \n            pose.rightShoulder.y,\n            pose.leftHip.y,\n            pose.rightHip.y\n        ];\n\n        return {\n            x: (Math.min (...x) + Math.max (...x)) / 2,\n            y: (pose.nose.y + Math.min(...y)) / 2\n        }\n    }\n\n    detected(estimation) {\n        if (estimation && this.callback) {\n            console.log(estimation.pose);\n            let anchor = this.calcAnchor(estimation.pose);\n            this.callback(anchor);\n        }\n    }\n}\n\nexport default TrunkDetector;","class Canvas {\n    constructor(id, video, width, height, img) {\n        this.elem = document.getElementById(id);\n        this.video = video;\n        \n        this.elem.width = width;\n        this.elem.height = height;\n        this.context = this.elem.getContext('2d');\n\n        this.anchor = null;\n\n        this.image = new Image();\n        this.image.onload = () => this.__loop();\n        this.image.src = img\n    }\n\n    __loop() {\n        this.context.drawImage(\n            this.video, \n            0, \n            0, \n            this.elem.width, \n            this.elem.height\n        );\n\n        if (this.anchor) this.__drawImage(this.anchor);\n        \n        window.requestAnimationFrame(() => this.__loop() );\n    }\n\n    __drawArea({ x, y, w, hÂ }) {\n        this.context.beginPath();\n        this.context.lineWidth = 10;\n        this.context.strokeStyle = '#00ff04';\n        this.context.rect(x, y, w, h);\n        this.context.stroke();\n    }\n\n    __drawPoint({ x, y, color = '#00ff04' }) {\n        this.context.beginPath();\n        this.context.arc(x, y, 10, 0, 2 * Math.PI);\n        this.context.fillStyle = color;\n        this.context.fill();\n    }\n\n    __drawImage({ x, y }) {\n        this.context.drawImage(\n            this.image, \n            x - this.image.width / 2, \n            y - 15\n        )\n    }\n}\n\nexport default Canvas;","import Webcam from './webcam.js'\nimport TrunkDetector from './trunkDetector.js'\nimport Canvas from './canvas'\n\nclass ARApp {\n    constructor(video, width, height) {\n        this.video = video;\n        this.webcam = new Webcam({ \n            video: this.video, \n            width: width,\n            height: height\n        });\n\n        this.detector = new TrunkDetector({ video: this.video });\n        this.canvas = new Canvas(\n            'canvas', \n            this.video, \n            width, \n            height,\n            '../assets/jacket.png'\n        );\n\n        this.webcam.init();\n    }\n\n    resume() {\n        console.log(\"Starting detector...\");\n        this.detector.start();\n\n        this.detector.onDetect((center) => {\n            this.canvas.anchor = center;\n        });\n    }\n\n    pause() {\n        console.log(\"Stopping detector...\");\n\n        this.detector = new TrunkDetector({ video: this.video });\n    }\n\n    confidenceArea(enabled = true) {\n        let area = {\n            x: (this.video.width / 2) - 250,\n            y: this.video.height / 6,\n            w: 500,\n            h: (this.video.height * 4 / 5)\n        }\n\n        this.canvas.detectionArea = enabled ? area : null;\n    }\n\n}\n\nexport default ARApp;","import ARApp from './app'\n\nlet video = document.getElementById(\"video\");\n\nlet app = new ARApp(video, 1024, 1024);\n\nvar enabled = false;\ndocument.getElementById(\"control\").addEventListener(\"click\", () => {\n    if (enabled) app.pause();\n    else app.resume();\n\n    enabled = !enabled;\n});\n\ndocument.getElementById(\"capture\").addEventListener(\"click\", () => {\n    app.capture();\n});"],"names":["Webcam","video","width","height","autostart","navigator","mediaDevices","getUserMedia","facingMode","stream","srcObject","Promise","resolve","onloadedmetadata","play","TrunkDetector","callback","options","architecture","imageScaleFactor","outputStride","inputResolution","flipHorizontal","minConfidence","maxPoseDetections","scoreThreshold","nmsRadius","detectionType","multiplier","quantBytes","net","ml5","poseNet","ready","console","log","on","res","detected","pose","x","leftShoulder","rightShoulder","leftHip","rightHip","y","Math","min","max","nose","estimation","anchor","calcAnchor","Canvas","id","img","elem","document","getElementById","context","getContext","image","Image","onload","__loop","src","drawImage","__drawImage","window","requestAnimationFrame","w","h","beginPath","lineWidth","strokeStyle","rect","stroke","color","arc","PI","fillStyle","fill","ARApp","webcam","detector","canvas","init","start","onDetect","center","enabled","area","detectionArea","app","addEventListener","pause","resume","capture"],"mappings":"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"}